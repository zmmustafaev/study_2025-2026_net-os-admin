---
## Front matter
title: "Отчёт по лабораторной работе 6"
subtitle: "Установка и настройка системы управления базами данных MariaDB"
author: "Заур Мустафаев"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true # Table of contents
toc-depth: 2
lof: true # List of figures
lot: true # List of tables
fontsize: 12pt
linestretch: 1.5
papersize: a
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
	- spelling=modern
	- babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math
mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9
mathfontoptions:
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float} # keep figures where there are in the text
  - \floatplacement{figure}{H} # keep figures where there are in the text
---

# Цель работы

Приобретение практических навыков по установке и конфигурированию системы управления базами данных на примере программного обеспечения MariaDB.

# Выполнение работы

## Установка и первичная настройка MariaDB

1. Загружена операционная система, выполнен вход на виртуальную машину **server**, открыт терминал и получены права суперпользователя.

2. Установлены необходимые пакеты **mariadb** и **mariadb-server**, обеспечивающие работу сервера баз данных MariaDB и клиентских утилит.

   ![Установка пакетов MariaDB](01.png){ #fig:001 width=80% }

3. Просмотрено содержимое каталога `/etc/my.cnf.d`, содержащего дополнительные конфигурационные файлы MariaDB, а также основной конфигурационный файл `/etc/my.cnf`.

   Основной файл `/etc/my.cnf`:
   - содержит секцию `[client-server]`, общую для клиента и сервера;
   - директива `!includedir /etc/my.cnf.d` указывает на подключение всех конфигурационных файлов из соответствующего каталога.

   ![Просмотр конфигурационных файлов MariaDB](01.png){ #fig:002 width=80% }

4. Сервис **mariadb** был запущен и добавлен в автозагрузку с использованием `systemctl`.

5. Проверено, что сервер MariaDB корректно запущен и прослушивает стандартный порт **3306**, что подтверждается наличием процесса `mariadbd`.

   ![Проверка прослушивания порта 3306](02.png){ #fig:003 width=80% }

## Применение параметров безопасности MariaDB

1. Запущен скрипт первичной настройки безопасности `mysql_secure_installation`.

2. В ходе диалога:
   - удалены анонимные пользователи;
   - запрещён удалённый вход для пользователя `root`;
   - удалена тестовая база данных `test`;
   - применены изменения таблиц привилегий.

   ![Выполнение mysql_secure_installation](03.png){ #fig:004 width=80% }

## Проверка работы MariaDB и системных баз данных

1. Выполнен вход в MariaDB под пользователем `root` с использованием пароля.

2. С помощью SQL-запроса `SHOW DATABASES;` получен список доступных баз данных.

   В системе по умолчанию присутствуют следующие базы данных:
   - `information_schema` — служебная база с метаданными;
   - `mysql` — база данных с учетными записями и правами доступа;
   - `performance_schema` — база для мониторинга производительности;
   - `sys` — вспомогательные представления для анализа состояния сервера.

   ![Список баз данных MariaDB](04.png){ #fig:005 width=80% }

3. Из интерактивной оболочки MariaDB выполнен выход командой `exit`.

## Анализ статуса MariaDB

1. Повторно выполнен вход в MariaDB под пользователем `root`.

2. Командой `status` получена информация о текущем состоянии сервера MariaDB.

   Выведенная информация содержит:
   - версию клиента и сервера MariaDB;
   - идентификатор соединения;
   - используемый сокет и протокол;
   - кодировки сервера, клиента и соединения;
   - время работы сервера;
   - статистику потоков и запросов.

   ![Статус MariaDB до изменения кодировки](05.png){ #fig:006 width=80% }

## Конфигурация кодировки символов

1. В каталоге `/etc/my.cnf.d` создан конфигурационный файл `utf8.cnf`.

2. В файл добавлены параметры:
   - для клиента — установка кодировки `utf8`;
   - для сервера — установка серверной кодировки `utf8`.

   ![Настройка файла utf8.cnf](06.png){ #fig:007 width=80% }

3. Сервис **mariadb** был перезапущен для применения изменений.

4. После перезапуска выполнен повторный вход в MariaDB и снова получен статус сервера.

   Установлено, что:
   - кодировка сервера изменилась на `utf8mb3`;
   - кодировка базы данных и соединения соответствует заданным параметрам;
   - изменения вступили в силу корректно.

   ![Статус MariaDB после изменения кодировки](07.png){ #fig:008 width=80% }

## Создание базы данных и управление доступом

1. Выполнен вход в систему управления базами данных MariaDB под пользователем `root` с правами администратора.

2. Создана база данных **addressbook** с указанием кодировки `utf8` и правил сравнения `utf8_general_ci`, что обеспечивает корректное хранение и обработку кириллических символов.

   ![Создание базы данных addressbook](08.png){ #fig:009 width=80% }

3. Выполнен переход к работе с базой данных **addressbook**. Проверено отсутствие таблиц в новой базе данных.

4. Создана таблица **city** с двумя полями строкового типа:
   - `name` — имя человека;
   - `city` — название города проживания.

5. В таблицу **city** добавлены тестовые записи с данными о трёх пользователях. После этого выполнен запрос `SELECT * FROM city;`, который вывел все строки таблицы.

   Результат запроса подтверждает корректность создания таблицы и успешную вставку данных.

   ![Заполнение и выборка данных из таблицы city](08.png){ #fig:010 width=80% }

6. Создан пользователь **zmustafaev** с доступом к базе данных по сети и задан пароль.

7. Пользователю **zmustafaev** предоставлены права на просмотр, добавление, изменение и удаление данных в базе **addressbook**. После этого выполнено обновление таблиц привилегий.

8. Получена структура таблицы **city** с помощью команды `DESCRIBE city;`, что позволило убедиться в корректности типов данных и параметров столбцов.

   ![Описание структуры таблицы city](09.png){ #fig:011 width=80% }

9. Выполнен выход из интерактивной оболочки MariaDB.

10. С помощью утилиты `mysqlshow` получен список всех баз данных сервера, включая созданную базу **addressbook**.

11. Проверен список таблиц базы данных **addressbook** как от имени администратора, так и от имени созданного пользователя, что подтверждает корректность настроенных прав доступа.

   ![Просмотр баз данных и таблиц с помощью mysqlshow](10.png){ #fig:012 width=80% }

## Резервное копирование и восстановление базы данных

1. На виртуальной машине **server** создан каталог `/var/backup`, предназначенный для хранения резервных копий баз данных.

2. Создана полная резервная копия базы данных **addressbook** в текстовом формате SQL.

3. Создана сжатая резервная копия базы данных с использованием утилиты `gzip`.

4. Создана сжатая резервная копия базы данных с автоматическим добавлением даты и времени создания в имя файла.

5. Проверено наличие созданных резервных копий в каталоге `/var/backup`.

6. Выполнено восстановление базы данных **addressbook** из обычной резервной копии.

7. Выполнено восстановление базы данных **addressbook** из сжатой резервной копии с использованием конвейера команд.

   ![Резервное копирование и восстановление базы данных](11.png){ #fig:013 width=80% }

## Внесение изменений в настройки внутреннего окружения виртуальной машины

1. В каталоге `/vagrant/provision/server` создана структура подкаталогов для конфигурации MariaDB и хранения резервных копий базы данных.

2. Конфигурационный файл `utf8.cnf` скопирован в каталог `/vagrant/provision/server/mysql/etc/my.cnf.d`, что обеспечивает применение настроек кодировки при автоматическом развёртывании виртуальной машины.

3. Резервные копии базы данных **addressbook** скопированы в каталог `/vagrant/provision/server/mysql/var/backup`.

4. В каталоге `/vagrant/provision/server` создан исполняемый сценарий **mysql.sh**, предназначенный для автоматической установки, настройки MariaDB, применения параметров безопасности и восстановления базы данных из резервной копии.

   ![Сценарий автоматической установки и настройки MariaDB](12.png){ #fig:014 width=80% }

# Вывод

В ходе работы была выполнена установка и базовая настройка системы управления базами данных MariaDB. Реализованы меры по повышению безопасности, включая удаление тестовых объектов и ограничение удалённого доступа. Создана пользовательская база данных, настроены права доступа, выполнены операции добавления и выборки данных. Также были рассмотрены процедуры резервного копирования и восстановления базы данных, а также подготовлены файлы и сценарий для автоматизации развёртывания в среде Vagrant.

# Контрольные вопросы

1. **Какая команда отвечает за настройки безопасности в MariaDB?**  
   Для настройки параметров безопасности используется команда `mysql_secure_installation`, которая позволяет задать пароль администратора, удалить анонимных пользователей, отключить удалённый доступ для root и удалить тестовую базу данных.

2. **Как настроить MariaDB для доступа через сеть?**  
   Для сетевого доступа необходимо:
   - разрешить прослушивание сетевых интерфейсов в конфигурационных файлах (параметр `bind-address`);
   - создать пользователя с указанием хоста, например `user@'%'`;
   - выдать необходимые права доступа с помощью `GRANT`;
   - при необходимости открыть порт 3306 в файрволе.

3. **Какая команда позволяет получить обзор доступных баз данных после входа в среду оболочки MariaDB?**  
   Для просмотра списка баз данных используется SQL-команда `SHOW DATABASES;`.

4. **Какая команда позволяет узнать, какие таблицы доступны в базе данных?**  
   После выбора базы данных командой `USE имя_базы;` применяется команда `SHOW TABLES;`.

5. **Какая команда позволяет узнать, какие поля доступны в таблице?**  
   Для просмотра структуры таблицы используется команда `DESCRIBE имя_таблицы;`.

6. **Какая команда позволяет узнать, какие записи доступны в таблице?**  
   Для вывода всех записей таблицы применяется SQL-запрос `SELECT * FROM имя_таблицы;`.

7. **Как удалить запись из таблицы?**  
   Удаление записи выполняется с помощью команды  
   `DELETE FROM имя_таблицы WHERE условие;`,  
   где условие определяет, какие строки должны быть удалены.

8. **Где расположены файлы конфигурации MariaDB? Что можно настроить с их помощью?**  
   Основные файлы конфигурации находятся в `/etc/my.cnf` и каталоге `/etc/my.cnf.d/`.  
   С их помощью можно настроить сетевые параметры, кодировку, параметры хранения данных, логирование, производительность и безопасность сервера.

9. **Где располагаются файлы с базами данных MariaDB?**  
   Файлы баз данных MariaDB по умолчанию хранятся в каталоге `/var/lib/mysql/`, где каждая база данных представлена отдельным подкаталогом.

10. **Как сделать резервную копию базы данных и затем её восстановить?**  
    Для создания резервной копии используется утилита `mysqldump`, например:  
    `mysqldump -u root -p имя_базы > backup.sql`.  
    Восстановление выполняется командой:  
    `mysql -u root -p имя_базы < backup.sql`.  
    Для сжатых копий может использоваться `gzip` и `zcat`.


# Список литературы

1. MariaDB Foundation. — URL: https://mariadb.org (дата обр. 13.09.2021).
2. Документация по MariaDB. — URL: https://mariadb.com/kb/ru/5306/.
3. Основы языка SQL. — URL: http://citforum.ru/programming/32less/les44.shtml (дата обр. 13.09.2021).